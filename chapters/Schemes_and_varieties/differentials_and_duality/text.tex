\section{Differentials and duality}

Let \(S\) be a base noetherian scheme.
Unless otherwise specified, all schemes and varieties are assumed to be defined and of finite type over \(S\).

% Let \(\kkk\) be an algebraically closed field.
% Unless otherwise specified, all schemes and varieties are assumed to be defined and of finite type over \(\kkk\).

\subsection{The sheaves of differentials}

    \begin{definition}\label{def:sheaves_of_differentials}
        Let \(X\) be an \(S\)-scheme.
        The \emph{sheaf of differentials} of \(X\) over \(S\), denoted by \(\Omega_{X/S}\), is the \(\calO_X\)-module representing the functor from the category of \(\calO_X\)-modules to the category of sets that sends an \(\calO_X\)-module \(\calF\) to the set of \(S\)-derivations from \(\calO_X\) to \(\calF\), i.e.,
        \[
            \Hom_{\calO_X}(\Omega_{X/S}, \calF) \cong \Der_S(\calO_X, \calF).
        \]
        Equivalently, \(\Omega_{X/S}\) is the sheaf associated to the presheaf that sends an open subset \(U \subseteq X\) to the module of KÃ¤hler differentials \(\Omega_{\calO_X(U)/\calO_S(f(U))}\), where \(f: X \to S\) is the structure morphism.

        \Yang{To be revised.}
    \end{definition}


    \begin{theorem}[Euler sequence for projective bundle]\label{thm:Euler_sequence_for_projective_bundle}
        
    \end{theorem}

    \begin{definition}\label{def:canonical_divisor_on_normal_varieties}
        Let \(X\) be a normal variety over \(\kkk\) of dimension \(n\).
        If \(X\) is smooth, then the \emph{canonical divisor} \(K_X\) is defined to be \(c_1(\omega_X)\).
        In general, let \(U\subseteq X\) be the smooth locus of \(X\) and \(i:U\hookrightarrow X\) be the inclusion map.
        Then the \emph{canonical divisor} \(K_X\) is defined to be any Weil divisor on \(X\) such that \(\calO_X(K_X)\cong i_*\omega_U\).
        Note that \(U\) is big in \(X\) since \(X\) is normal, so such a Weil divisor always exists and is unique up to linear equivalence.
    \end{definition}

\subsection{Fundamental sequence}

    \begin{theorem}[The first fundamental sequence of differentials]\label{thm:the_first_fundamental_sequence_of_differentials}
        Let \(f: X \to Y\) be a morphism of schemes.
        Then there is a natural exact sequence of \(\calO_X\)-modules
        \[
            f^* \Omega_{Y/S} \to \Omega_{X/S} \to \Omega_{X/Y} \to 0.
        \]
        Suppose further that \(f\) is smooth.
        Then the above sequence is also exact on the left.
        \Yang{... it will be exact.}
    \end{theorem}



    \begin{theorem}[The second fundamental sequence of differentials]\label{thm:the_second_fundamental_sequence_of_differentials}
        Let \(Z \subseteq X\) be a closed subscheme defined by the sheaf of ideals \(\calI \subseteq \calO_X\).
        Then there is a natural exact sequence of \(\calO_X\)-modules
        \[
            \calJ/\calJ^2 \to \Omega_{X/S}|_Z \to \Omega_{Z/S} \to 0.
        \]

        Suppose further that \(Z\) is locally a complete intersection in \(X\).
        Then the above sequence is also exact on the left.
        \Yang{... it will be exact.}
    \end{theorem}



\subsection{Application of fundamental sequences}

        \begin{theorem}[Ramification formula]\label{thm:ramification_formula}
        Let \(f: X \to Y\) be a finite morphism of normal varieties. 
        Then 
        \[
            K_X = f^*K_Y + R_f,
        \]
        where 
        \[ R_f := \sum_{D \subseteq X \text{ prime divisor}} \left( \Mult_D f^*\big(f(D)\big)-1 \right) D \]
        is the ramification divisor of \(f\).
        % \Yang{It is wrong.}
    \end{theorem}


    \begin{theorem}[Adjunction formula]\label{thm:adjunction_formula_smooth_case}
        Let \(X\) be a smooth variety and \(Z \subseteq X\) be a smooth subvariety of codimension \(1\).
        Then 
        \[ K_Z = (K_X + Z)|_Z. \]
        %\Yang{It is wrong.}
    \end{theorem}


\subsection{Serre duality}

    \begin{theorem}[Serre duality]\label{thm:Serre_duality}
        Let \(X\) be a proper variety over \(\kkk\) and let \(\calF\) be a coherent sheaf on \(X\).
        Then there is a natural isomorphism
        \[
            H^i(X, \calF) \cong H^{n-i}(X, \calF^\vee \otimes \omega_X)^\vee,
        \]
        where \(\omega_X\) is the canonical sheaf on \(X\) and \(\calF^\vee = \mathcal{H}om_{\calO_X}(\calF, \calO_X)\) is the dual sheaf.
        \Yang{there are some errors. Need to be revised}
    \end{theorem}

\subsection{Logarithm version}